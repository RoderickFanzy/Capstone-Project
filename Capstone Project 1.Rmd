---
title: "Capstone Project"
author: "Roderick Fan"
date: "2023-03-29"
output: html_document
---

Clean Environment
Loading Packages, dataset
```{r}
rm(list = ls())
cat("\14")
library(tidyverse)
library(here)
library(lubridate)
spot <- read.csv(here("Spot Data.csv"))
```
Preprocessing
```{r}
#Replace Patient ID with Rownames
spot$Patient.ID <- rownames(spot$Patient.ID)

#Binomial Sex
spot$Patient.Sex <- as.factor(spot$Patient.Sex)

#Dropping Redundant Predictors
t(t(colnames(spot)))
spot <- spot[,-c(4)]

#Factoring Specimen Type
spot$Specimen.Type <- as.factor(spot$Specimen.Type)

#Factoring and Renaming Client Location
spot$Client.ID <- as.factor(spot$Client.ID)
levels(spot$Client.ID) <- c("Location A","Location B","Location C","Location D","Location E","Location F",
                            "Location G","Location H","Location I","Location J","Location K","Location L",
                            "Location M","Location N","Location O","Location P","Location Q","Location R")
table(spot$Client.ID)

#Convert and Simplify Datetime columns
datetime_cols <- c("Datetime.Kit.Delivered", "Datetime.Kit.Registered", "Datetime.Sample.Sent.In", "Datetime.Sample.Received", "Datetime.of.End.Status")

for (col in datetime_cols) {
  spot[[col]] <- as.Date(substr(spot[[col]], 1, 10), format="%Y-%m-%d")
}

table(spot$End.Status)
```
```{r}
spot.clean <- spot[!(spot$End.Status %in% c("collected", "collection_exception","delivered","delivery_exception","partially_resulted","received")),]
reject <- subset(spot.clean, End.Status == "rejected")
spot.clean$Deliever.Register <- as.numeric(difftime(spot.clean$Datetime.Kit.Registered, spot.clean$Datetime.Kit.Delivered,units = "day"))
spot.clean$Deliever.Sent <- as.numeric(difftime(spot.clean$Datetime.Sample.Sent.In, spot.clean$Datetime.Kit.Registered,units = "day"))
spot.clean$Sent.Receive <- as.numeric(difftime(spot.clean$Datetime.Sample.Received, spot.clean$Datetime.Sample.Sent.In,units = "day"))
spot.clean$Receive.Result <- as.numeric(difftime(spot.clean$Datetime.of.End.Status, spot.clean$Datetime.Sample.Received,units = "day"))
spot.clean$total.gap <-  as.numeric(difftime(spot.clean$Datetime.of.End.Status, spot.clean$Datetime.Kit.Delivered,units = "day"))

test1 <- na.omit(spot.clean)

summary(test1$total.gap)

threshold <-  1.5*(IQR(test1$total.gap))
outliers <- test1$total.gap < median(test1$total.gap) - threshold | test1$total.gap > median(test1$total.gap) + threshold
test1.clean <- test1[!outliers,]

```


```{r}

```


